<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Look Back And Look Forward</title>
  
  <subtitle>YOU</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://huazhiy.xyz/"/>
  <updated>2019-11-09T16:02:20.635Z</updated>
  <id>https://huazhiy.xyz/</id>
  
  <author>
    <name>huazhiy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-11-06T12:52:18.949Z</published>
    <updated>2019-11-09T16:02:20.635Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvLw==" title="https://hexo.io/">Hexo<i class="fa fa-external-link"></i></span>! This is your very first post. Check <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv" title="https://hexo.io/docs/">documentation<i class="fa fa-external-link"></i></span> for more info. If you get any problems when using Hexo, you can find the answer in <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=" title="https://hexo.io/docs/troubleshooting.html">troubleshooting<i class="fa fa-external-link"></i></span> or you can ask me on <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==" title="https://github.com/hexojs/hexo/issues">GitHub<i class="fa fa-external-link"></i></span>.</p><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s" title="https://hexo.io/docs/writing.html">Writing<i class="fa fa-external-link"></i></span></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=" title="https://hexo.io/docs/server.html">Server<i class="fa fa-external-link"></i></span></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s" title="https://hexo.io/docs/generating.html">Generating<i class="fa fa-external-link"></i></span></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s" title="https://hexo.io/docs/one-command-deployment.html">Deployment<i class="fa fa-external-link"></i></span></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9oZXhvLmlvLw==&quot; title=&quot;https://hexo.io/&quot;&gt;Hexo&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt;! This is your very first post. Check &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv&quot; title=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=&quot; title=&quot;https://hexo.io/docs/troubleshooting.html&quot;&gt;troubleshooting&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt; or you can ask me on &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==&quot; title=&quot;https://github.com/hexojs/hexo/issues&quot;&gt;GitHub&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt;.&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下安装bind</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-10-11T02:25:32.092Z</published>
    <updated>2019-11-09T16:02:20.625Z</updated>
    
    <content type="html"><![CDATA[<p>sudo yum -y install bind bind-chroot bind-utils</p><p>1、BIND配置文件保存在两个位置：<br>/etc/named.conf　　- BIND服务主配置文件<br>/var/named/　　　　- zone文件（域的dns信息）</p><p>如果安装了bind-chroot（其中chroot是 change root 的缩写），BIND会被封装到一个伪根目录内，配置文件的位置变为：<br>/var/named/chroot/etc/named.conf 　　- BIND服务主配置文件<br>/var/named/chroot/var/named/　　　　- zone文件<br>chroot是通过相关文件封装在一个伪根目录内，已达到安全防护的目的，一旦程序被攻破，将只能访问伪根目录内的内容，而不是真实的根目录</p><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><p>2、BIND安装好之后不会有预制的配置文件，但是在BIND的文档文件夹内（/usr/share/doc/bind-9.9.4），BIND为我们提供了配置文件模板，我们可以直接拷贝过来：<br>cp -r /usr/share/doc/bind-9.9.4/sample/etc/* /var/named/chroot/etc/<br>cp -r /usr/share/doc/bind-9.9.4/sample/var/* /var/named/chroot/var/</p><p>3、配置BIND服务的主配置文件（/var/named/chroot/etc/named.conf），命令：vim /var/named/chroot/etc/named.conf；<br>内容很多使用简单配置，删除文件中logging以下的全部内容，以及option中的部分内容，得到如下配置</p><p>1 /*<br>2 Sample named.conf BIND DNS server ‘named’ configuration file<br>3 for the Red Hat BIND distribution.<br>4<br>5 See the BIND Administrator’s Reference Manual (ARM) for details about the<br>6 configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html<br>7 */<br>8<br>9 options<br>10 {<br>11 // Put files that named is allowed to write in the data/ directory:<br>12 directory “/var/named”; // “Working” directory<br>13<br>14<br>15 //listen-on port 53 { any; };<br>16 listen-on port 53 { 127.0.0.1; };<br>17<br>18 //listen-on-v6 port 53 { any; };<br>19 listen-on-v6 port 53 { ::1; };<br>20<br>21 };</p><p>4、在主配置文件（/var/named/chroot/etc/named.conf ）中加入，zone参数<br>zone “cjrm.cjn.cn” {<br>type master;<br>file “cjrm.cjn.cn.zone”;<br>};</p><p>5、新建example.net.zone文件，example.net的域名解析文件，zone文件放在/var/named/chroot/var/named/下，zone文件可以已/var/named/chroot/var/named/named.localhost为模板。<br>命令：cp /var/named/chroot/var/named/named.localhost /var/named/chroot/var/named/example.net.zone</p><p>$TTL 1D<br>@ IN SOA @ rname.invalid. (<br>0 ; serial<br>1D ; refresh<br>1H ; retry<br>1W ; expire<br>3H ) ; minimum<br>NS @<br>A 127.0.0.1<br>AAAA ::1<br>www IN A 10.15.110.200</p><p>6、禁用bind默认方式启动，改用bind-chroot方式启动。命令如下：<br>[root@iZ2806l73p6Z named]# /usr/libexec/setup-named-chroot.sh /var/named/chroot on<br>[root@iZ2806l73p6Z named]# systemctl stop named<br>[root@iZ2806l73p6Z named]# systemctl disable named<br>[root@iZ2806l73p6Z named]# systemctl start named-chroot<br>[root@iZ2806l73p6Z named]# systemctl enable named-chroot</p><p>7、查看是否启动，命令：ps -ef|grep named</p><p>8、测试DNS服务，本例在本机上测试，也可在其他电脑上测试，修改DNS服务的ip地址即可（命令：vim /etc/resolv.conf ），然后使用命令dig（命令：dig <span class="exturl" data-url="aHR0cDovL3d3dy5leGFtcGxlLm5ldO+8iea1i+ivlQ==" title="http://www.example.net）测试">www.example.net）测试<i class="fa fa-external-link"></i></span></p><p><br>内容如下：<br><br>测试结果：</p><p>注：非本机测试需要修改主配置文件named.conf，允许任何ip访问，然后重启服务器</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;sudo yum -y install bind bind-chroot bind-utils&lt;/p&gt;&lt;p&gt;1、BIND配置文件保存在两个位置：&lt;br&gt;/etc/named.conf　　- BIND服务主配置文件&lt;br&gt;/var/named/　　　　- zone文件（域的dns信息）&lt;/p&gt;&lt;p&gt;如果安装了bind-chroot（其中chroot是 change root 的缩写），BIND会被封装到一个伪根目录内，配置文件的位置变为：&lt;br&gt;/var/named/chroot/etc/named.conf 　　- BIND服务主配置文件&lt;br&gt;/var/named/chroot/var/named/　　　　- zone文件&lt;br&gt;chroot是通过相关文件封装在一个伪根目录内，已达到安全防护的目的，一旦程序被攻破，将只能访问伪根目录内的内容，而不是真实的根目录&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>frps</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-09-12T16:31:01.033Z</published>
    <updated>2019-11-09T16:02:20.632Z</updated>
    
    <content type="html"><![CDATA[<p>Starting Frps(0.20.0)… done<br>Frps (pid 18688)is running.</p><p>+———————————————————+<br>| frps for Linux Server, Written by Clang |<br>+———————————————————+<br>| A tool to auto-compile &amp; install frps on Linux |<br>+———————————————————+<br>| Intro: <span class="exturl" data-url="aHR0cDovL2tvb2xzaGFyZS5jbi90aHJlYWQtNjUzNzktMS0xLmh0bWw=" title="http://koolshare.cn/thread-65379-1-1.html">http://koolshare.cn/thread-65379-1-1.html<i class="fa fa-external-link"></i></span> |<br>+———————————————————+</p><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h1 id="Congratulations-frps-install-completed"><a href="#Congratulations-frps-install-completed" class="headerlink" title="Congratulations, frps install completed!"></a>Congratulations, frps install completed!</h1><p>You Server IP : 104.224.140.11<br>Bind port : 9876<br>KCP support : true<br>vhost http port : 81<br>vhost https port : 444<br>Dashboard port : 6443<br>token : SNlriHoglOJGMsOJ<br>tcp_mux : true<br>Max Pool count : 50<br>Log level : info<br>Log max days : 3<br>Log file : enable<br>==============================================<br>frps Dashboard : <span class="exturl" data-url="aHR0cDovLzEwNC4yMjQuMTQwLjExOjY0NDMv" title="http://104.224.140.11:6443/">http://104.224.140.11:6443/<i class="fa fa-external-link"></i></span><br>Dashboard user : geolem<br>Dashboard password : Geolem<br>==============================================</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Starting Frps(0.20.0)… done&lt;br&gt;Frps (pid 18688)is running.&lt;/p&gt;&lt;p&gt;+———————————————————+&lt;br&gt;| frps for Linux Server, Written by Clang |&lt;br&gt;+———————————————————+&lt;br&gt;| A tool to auto-compile &amp;amp; install frps on Linux |&lt;br&gt;+———————————————————+&lt;br&gt;| Intro: &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL2tvb2xzaGFyZS5jbi90aHJlYWQtNjUzNzktMS0xLmh0bWw=&quot; title=&quot;http://koolshare.cn/thread-65379-1-1.html&quot;&gt;http://koolshare.cn/thread-65379-1-1.html&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt; |&lt;br&gt;+———————————————————+&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下安装postgresql</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-09-12T03:53:18.956Z</published>
    <updated>2019-11-09T16:02:20.633Z</updated>
    
    <content type="html"><![CDATA[<p>yum install <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5wb3N0Z3Jlc3FsLm9yZy9wdWIvcmVwb3MveXVtLzEwL3JlZGhhdC9yaGVsLTcteDg2XzY0L3BnZGctY2VudG9zMTAtMTAtMi5ub2FyY2gucnBt" title="https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm">https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm<i class="fa fa-external-link"></i></span> -y<br>安装postgresql</p><p>先查看postgresql源<br>yum list | grep postgresql</p><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><p>yum install postgresql10-contrib postgresql10-server -y</p><p>初始化数据库<br>Postgresql安装目录是/usr/pgsql-10,而Postgresql的数据目录是/var/lib/pgsql/版本号/data目录</p><p>在这里，如果在装系统开始分配var空间足够大则可以继续，如果分配var空间不够，我们需要更改数据目录，在这里，我们假设var空间足够大。直接开始初始化。</p><p>/usr/pgsql-10/bin/postgresql-10-setup initdb</p><p>启动数据库并设置开机启动</p><p>sudo systemctl start postgresql-10<br>sudo systemctl enable postgresql-10.service<br>journalctl -u wiki<br>登录postgresql并设置密码</p><p>postgresql在安装时默认添加用户postgres</p><p>输入</p><p>su - postgres<br>psql<br>我们来设置密码：</p><p>ALTER USER postgres WITH PASSWORD ‘密码’;</p><p>退出：\q</p><p>备注其他：列出所有库\l 列出所有用户\du 列出库下所有表\d</p><p>六、默认情况下postgresql是不用密码不支持远程登录的。我们需要修改配置文件</p><p>vi /var/lib/pgsql/10/data/pg_hba.conf</p><p>vi /var/lib/pgsql/10/data/postgresql.conf</p><p>重启postgresql<br>systemctl restart postgresql-10</p><p>创建数据库<br>CREATE DATABASE wiki;</p><p>创建用户<br>CREATE USER wikijs CREATEDB LOGIN PASSWORD ‘wikijsrocks’;<br>将wiki所有权限赋给用户wikijs<br>GRANT ALL ON DATABASE wiki TO wikijs;</p><p>删除数据库<br>drop database testdb;</p><p>删除用户<br>drop role testuser;</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;p&gt;yum install &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9kb3dubG9hZC5wb3N0Z3Jlc3FsLm9yZy9wdWIvcmVwb3MveXVtLzEwL3JlZGhhdC9yaGVsLTcteDg2XzY0L3BnZGctY2VudG9zMTAtMTAtMi5ub2FyY2gucnBt&quot; title=&quot;https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm&quot;&gt;https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm&lt;i class=&quot;fa fa-external-link&quot;&gt;&lt;/i&gt;&lt;/span&gt; -y&lt;br&gt;安装postgresql&lt;/p&gt;&lt;p&gt;先查看postgresql源&lt;br&gt;yum list | grep postgresql&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下samba安装</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-04-26T10:00:48.879Z</published>
    <updated>2019-11-09T16:02:20.623Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下samba安装"><a href="#centos7下samba安装" class="headerlink" title="centos7下samba安装"></a>centos7下samba安装</h1><hr><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">yum -y install samba samba-client samba-swat</span><br><span class="line">rpm -qi samba 验证安装结果</span><br><span class="line">（4）配置内核参数</span><br><span class="line">ulimit -n 16384</span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line">在最后加入以下内容</span><br><span class="line">* - nofile 16384</span><br><span class="line">（5）修改Samba 配置文件 vim /etc/samba/smb.conf</span><br><span class="line">[xhs]</span><br><span class="line">comment = 新华社专用共享</span><br><span class="line">path = /data/TRS/xhs/data/0/cnml/</span><br><span class="line">public = yes</span><br><span class="line">writable = yes</span><br><span class="line">valid users = xhs</span><br><span class="line">create mask = 0644</span><br><span class="line">force create mode = 0644</span><br><span class="line">directory mask = 0755</span><br><span class="line">force directory mode = 0755</span><br><span class="line">available = yes</span><br><span class="line"></span><br><span class="line">（6）开机启动smb服务</span><br><span class="line">systemctl restart smb</span><br><span class="line">systemctl enable smb</span><br><span class="line">systemctl status smb</span><br><span class="line">（7）将root用户设置为 samba用户</span><br><span class="line">smbpasswd -a xhs</span><br><span class="line">在windows中就可以这样访问了：</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --add-port=139/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=445/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=137/udp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=138/udp --permanent</span><br><span class="line"> </span><br><span class="line">firewall-cmd --reload</span><br><span class="line">systemctl restart firewalld.service</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;centos7下samba安装&quot;&gt;&lt;a href=&quot;#centos7下samba安装&quot; class=&quot;headerlink&quot; title=&quot;centos7下samba安装&quot;&gt;&lt;/a&gt;centos7下samba安装&lt;/h1&gt;&lt;hr&gt;&lt;h2 id=&quot;安装&quot;&gt;&lt;a hr
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下fastdfs安装</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-04-19T09:25:08.194Z</published>
    <updated>2019-11-09T16:02:20.614Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下fastdfs安装"><a href="#centos7下fastdfs安装" class="headerlink" title="centos7下fastdfs安装"></a>centos7下fastdfs安装</h1><hr><h2 id="1-fastdfs安装"><a href="#1-fastdfs安装" class="headerlink" title="1. fastdfs安装"></a>1. fastdfs安装</h2><h3 id="1-1-介质准备"><a href="#1-1-介质准备" class="headerlink" title="1.1 介质准备"></a>1.1 介质准备</h3><h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TODO</span><br></pre></td></tr></table></figure><h3 id="1-3-安全配置"><a href="#1-3-安全配置" class="headerlink" title="1.3 安全配置"></a>1.3 安全配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start</span><br><span class="line">/usr/bin/fdfs_storaged  /etc/fdfs/storage.conf start</span><br><span class="line">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h2 id="2-nginx模块安装"><a href="#2-nginx模块安装" class="headerlink" title="2. nginx模块安装"></a>2. nginx模块安装</h2><h3 id="2-1-介质准备"><a href="#2-1-介质准备" class="headerlink" title="2.1 介质准备"></a>2.1 介质准备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.14.2.tar.gz</span><br><span class="line">fastdfs-nginx-module_v1.16.tar.gz</span><br></pre></td></tr></table></figure><h3 id="2-2-安装nginx并编译fastdfs模块"><a href="#2-2-安装nginx并编译fastdfs模块" class="headerlink" title="2.2 安装nginx并编译fastdfs模块"></a>2.2 安装nginx并编译fastdfs模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">-&gt;root用户执行依赖安装</span><br><span class="line">yum -y install gcc automake autoconf libtool make gcc-c++ pcre* zlib openssl openssl-devel</span><br><span class="line">cd /data/TRS/softwares</span><br><span class="line">tar zxf fastdfs-nginx-module_v1.16.tar.gz</span><br><span class="line">tar zxf nginx-1.14.2.tar.gz$$</span><br><span class="line">sudo ln -sv /usr/include/fastcommon /usr/local/include/fastcommon</span><br><span class="line">sudo ln -sv /usr/include/fastdfs /usr/local/include/fastdfs</span><br><span class="line">-&gt;拷贝相关fastdfs安装后的文件到/etc/fdfs目录下：</span><br><span class="line">sudo cp /data/TRS/softwares/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/</span><br><span class="line">sudo cp /opt/fastdfs/fastdfs-master/conf/mime.types /etc/fdfs/</span><br><span class="line">sudo cp /opt/fastdfs/fastdfs-master/conf/http.conf /etc/fdfs/</span><br><span class="line">sudo cp /opt/fastdfs/fastdfs-master/conf/anti-steal.jpg /etc/fdfs/</span><br><span class="line"></span><br><span class="line">-&gt;提前创建安装目录并设置目录所属为普通用户[root用户操作]</span><br><span class="line">mkdir /opt/nginx</span><br><span class="line">chown -R trs:trs /opt/nginx</span><br><span class="line">cd nginx-1.14.2</span><br><span class="line">-&gt;配置nginx，注意路径根据实际情况修改</span><br><span class="line">sudo ./configure --prefix=/opt/nginx --sbin-path=/opt/nginx/sbin/nginx --conf-path=/opt/nginx/conf/nginx.conf --error-log-path=/data/TRS/logs/nginx_logs/error.log --http-log-path=/data/TRS/logs/nginx_logs/access.log --pid-path=/opt/nginx/nginx.pid --lock-path=/var/lock/nginx.lock --with-http_ssl_module  --with-http_gzip_static_module --add-module=/data/TRS/softwares/fastdfs-nginx-module/src</span><br><span class="line">-&gt;编译安装</span><br><span class="line">sudo make &amp;&amp; make install</span><br><span class="line">-&gt;修改nginx配置</span><br><span class="line">vi /opt/nginx/conf/nginx.conf</span><br><span class="line">-&gt;核心内容</span><br><span class="line">server &#123;</span><br><span class="line">        #端口与 /etc/fdfs/storage.conf 中的 http.server_port 一致</span><br><span class="line">        listen       8188;</span><br><span class="line">        server_name  本机IP或域名;</span><br><span class="line">location ~/group([0-9])/M00 &#123;</span><br><span class="line">    ngx_fastdfs_module;</span><br><span class="line">&#125;</span><br><span class="line">-&gt;TODO：nginx优化</span><br><span class="line">-&gt;修改 /etc/fdfs/mod_fastdfs.conf 的配置</span><br><span class="line">sudo vi /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">-&gt;内容</span><br><span class="line">base_path=/data/TRS/data/fastdfs/storage/  #保存日志目录</span><br><span class="line">tracker_server=10.15.110.41:22122  #tracker 服务器的 IP 地址以及端口号</span><br><span class="line">url_have_group_name = true #文件 url 中是否有 group 名</span><br><span class="line">store_path0=/data/TRS/data/fastdfs/storage/ # 存储路径</span><br><span class="line">http.need_find_content_type=true  # 从文件扩展名查找文件类型 （nginx 时 为true）</span><br><span class="line">group_count = 3  #设置组的个数，事实上这次只使用了group1</span><br><span class="line">-&gt;在文件末添加如下内容：</span><br><span class="line">[group1]</span><br><span class="line">group_name=group1</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/data/TRS/data/fastdfs/storage/</span><br><span class="line"></span><br><span class="line">[group2]</span><br><span class="line">group_name=group2</span><br><span class="line">storage_server_port=23000</span><br><span class="line">store_path_count=1</span><br><span class="line">store_path0=/data/TRS/data/fastdfs/storage/</span><br><span class="line"></span><br><span class="line">-&gt;建立 M00 至存储目录的符号连接：</span><br><span class="line">ln -s /data/TRS/data/fastdfs/storage/data /data/TRS/data/fastdfs/storage/data/M00</span><br><span class="line">-&gt;创建软链接的好处是方便多目录的管理。</span><br><span class="line">-&gt;启动Nginx,就可以使用HTTP下载了。</span><br><span class="line"></span><br><span class="line">-&gt;开放防火墙</span><br><span class="line">sudo firewall-cmd --zone=public --add-port=8188/tcp --permanent</span><br><span class="line">-&gt;刷新配置</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line">-&gt;查看已开放的端口</span><br><span class="line">sudo firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><h2 id="3-使用过程"><a href="#3-使用过程" class="headerlink" title="3. 使用过程"></a>3. 使用过程</h2><h3 id="3-1-如何清空数据"><a href="#3-1-如何清空数据" class="headerlink" title="3.1 如何清空数据"></a>3.1 如何清空数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">停止tracker和storage，分别删除tracker和storage主目录下data和logs等子目录，启动后fdfs_monitor查看空间情况</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;centos7下fastdfs安装&quot;&gt;&lt;a href=&quot;#centos7下fastdfs安装&quot; class=&quot;headerlink&quot; title=&quot;centos7下fastdfs安装&quot;&gt;&lt;/a&gt;centos7下fastdfs安装&lt;/h1&gt;&lt;hr&gt;&lt;h2 id=&quot;1-fastdfs安装&quot;&gt;&lt;a href=&quot;#1-fastdfs安装&quot; class=&quot;headerlink&quot; title=&quot;1. fastdfs安装&quot;&gt;&lt;/a&gt;1. fastdfs安装&lt;/h2&gt;&lt;h3 id=&quot;1-1-介质准备&quot;&gt;&lt;a href=&quot;#1-1-介质准备&quot; class=&quot;headerlink&quot; title=&quot;1.1 介质准备&quot;&gt;&lt;/a&gt;1.1 介质准备&lt;/h3&gt;&lt;h3 id=&quot;1-2-安装&quot;&gt;&lt;a href=&quot;#1-2-安装&quot; class=&quot;headerlink&quot; title=&quot;1.2 安装&quot;&gt;&lt;/a&gt;1.2 安装&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;TODO&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;1-3-安全配置&quot;&gt;&lt;a href=&quot;#1-3-安全配置&quot; class=&quot;headerlink&quot; title=&quot;1.3 安全配置&quot;&gt;&lt;/a&gt;1.3 安全配置&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/bin/fdfs_storaged  /etc/fdfs/storage.conf start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/bin/fdfs_monitor /etc/fdfs/storage.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下yapi安装</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-04-12T12:07:13.809Z</published>
    <updated>2019-11-09T16:02:20.629Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下yapi安装"><a href="#centos7下yapi安装" class="headerlink" title="centos7下yapi安装"></a>centos7下yapi安装</h1><hr><h2 id="1-安装前系统优化"><a href="#1-安装前系统优化" class="headerlink" title="1. 安装前系统优化"></a>1. 安装前系统优化</h2><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h2><h3 id="2-1-安装nodejs"><a href="#2-1-安装nodejs" class="headerlink" title="2.1 安装nodejs"></a>2.1 安装nodejs</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-&gt;获取安装包</span><br><span class="line">wget http://nodejs.org/dist/v11.9.0/node-v11.9.0-linux-x64.tar.gz  </span><br><span class="line">-&gt;解压</span><br><span class="line">tar xf node-v11.9.0-linux-x64.tar.gz </span><br><span class="line">-&gt;链接到 /usr/bin</span><br><span class="line">sudo ln -s /TRS/softwares/node-v11.9.0-linux-x64/bin/node /usr/bin/node</span><br><span class="line">sudo ln -s /TRS/softwares/node-v11.9.0-linux-x64/bin/npm /usr/bin/npm</span><br><span class="line">-&gt;校验</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h3 id="2-2-安装mongodb"><a href="#2-2-安装mongodb" class="headerlink" title="2.2 安装mongodb"></a>2.2 安装mongodb</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-&gt;添加mongodb源文件</span><br><span class="line">vi /etc/yum.repos.d/mongodb-org-4.0.repo</span><br><span class="line">-&gt;内容</span><br><span class="line">[mongodb-org-4.0]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc</span><br><span class="line"></span><br><span class="line">-&gt;安装</span><br><span class="line">sudo yum install -y mongodb-org</span><br><span class="line">-&gt;校验</span><br><span class="line">mongod --version</span><br><span class="line">-&gt;启动mongodb</span><br><span class="line">sudo service mongod start</span><br><span class="line">-&gt;设置开机启动</span><br><span class="line">sudo chkconfig mongod on</span><br><span class="line">-&gt;打开moMongoDB(可忽略)</span><br><span class="line">/bin/mongo</span><br><span class="line">-&gt;配置远程访问</span><br><span class="line">-&gt;修改mongod.conf配置文件</span><br><span class="line">vim/etc/mongod.conf</span><br><span class="line">-&gt;注释 bindIp: 127.0.0.1</span><br><span class="line">#bindIp: 127.0.0.1</span><br><span class="line">-&gt;重启mongod</span><br><span class="line">service mongod restart</span><br><span class="line">-&gt;备份所有数据库</span><br><span class="line">mongodump</span><br></pre></td></tr></table></figure><h2 id="2-3-安装yapi"><a href="#2-3-安装yapi" class="headerlink" title="2.3 安装yapi"></a>2.3 安装yapi</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-&gt;安装</span><br><span class="line">npm install -g yapi-cli --registry https://registry.npm.taobao.org </span><br><span class="line">yapi server </span><br><span class="line">-&gt;若提示yapi: 未找到命令，可通过 npm get prefix 获取npm包的位置，切换到该目录node_modules/bin目录下，运行 ./yapi server 进行安装</span><br><span class="line">/TRS/softwares/node-v11.9.0-linux-x64/bin/yapi server</span><br><span class="line">-&gt;在浏览器打开 http://0.0.0.0:9090 访问。非本地服务器，请将 0.0.0.0 替换成指定的域名或ip </span><br><span class="line">-&gt;根据页面提示填写相关信息，一会后，日志底部会有管理员账户密码、如何启动等信息</span><br><span class="line">-&gt;部署成功，请切换到部署目录，输入： &quot;node vendors/server/app.js&quot; 指令启动服务器</span><br><span class="line"></span><br><span class="line">-&gt;启动</span><br><span class="line">nohup node /TRS/application/my-yapi/vendors/server/app.js &amp;</span><br><span class="line"></span><br><span class="line">-&gt;更新</span><br><span class="line">-&gt;进入项目目录后执行更新</span><br><span class="line">cd /TRS/application/my-yapi</span><br><span class="line">/TRS/softwares/node-v11.9.0-linux-x64/bin/yapi update</span><br><span class="line">-&gt;重启</span><br></pre></td></tr></table></figure><h2 id="2-4-安装yapi相关插件"><a href="#2-4-安装yapi相关插件" class="headerlink" title="2.4 安装yapi相关插件"></a>2.4 安装yapi相关插件</h2><p>1) <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3pnczIyNS95YXBpLXBsdWdpbi1kZGluZw==" title="https://github.com/zgs225/yapi-plugin-dding">https://github.com/zgs225/yapi-plugin-dding<i class="fa fa-external-link"></i></span><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-&gt;安装ykit</span><br><span class="line">sudo npm install -g ykit</span><br><span class="line">-&gt;提示找不到ykit，需做一下软连接如：sudo ln -s /data/TRS/softwares/node-v12.11.1-linux-x64/bin/ykit /usr/local/bin/</span><br><span class="line">-&gt;进入项目目录安装插件</span><br><span class="line">cd /TRS/application/my-yapi/</span><br><span class="line">/TRS/softwares/node-v11.9.0-linux-x64/bin/yapi plugin --name yapi-plugin-dingding</span><br></pre></td></tr></table></figure><br>2) <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luY2VwdGlvbmd0L1lhcGktcGx1Z2luLWV4cG9ydC1kb2N4LWRhdGE=" title="https://github.com/inceptiongt/Yapi-plugin-export-docx-data">https://github.com/inceptiongt/Yapi-plugin-export-docx-data<i class="fa fa-external-link"></i></span><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>3）<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N5ajAxMjIveWFwaS1wbHVnaW4tZ2l0bGFi" title="https://github.com/cyj0122/yapi-plugin-gitlab">https://github.com/cyj0122/yapi-plugin-gitlab<i class="fa fa-external-link"></i></span><br>4）<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZvbGxvdy1teS1oZWFydC95YXBpLXBsdWdpbi1pbXBvcnQtc3dhZ2dlci1jdXN0b21pemU=" title="https://github.com/follow-my-heart/yapi-plugin-import-swagger-customize">https://github.com/follow-my-heart/yapi-plugin-import-swagger-customize<i class="fa fa-external-link"></i></span><p></p><h2 id="2-5-pm2管理node应用"><a href="#2-5-pm2管理node应用" class="headerlink" title="2.5 pm2管理node应用"></a>2.5 pm2管理node应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://pm2.keymetrics.io/docs/usage/quick-start/</span><br><span class="line">https://imweb.io/topic/57c8cbb27f226f687b365636</span><br><span class="line"></span><br><span class="line">pm2 install pm2-logrotate</span><br></pre></td></tr></table></figure><h2 id="2-6-yapi定时备份mongodb"><a href="#2-6-yapi定时备份mongodb" class="headerlink" title="2.6 yapi定时备份mongodb"></a>2.6 yapi定时备份mongodb</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt;vi backup.sh</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line"># args</span><br><span class="line">basepath=$(cd `dirname $0`; pwd)</span><br><span class="line">datapath=$basepath</span><br><span class="line">olddatapath=$basepath&apos;/backupdata7days&apos;</span><br><span class="line">mdpath=&quot;/usr/bin/mongodump&quot;</span><br><span class="line">databasename=&quot;yapi&quot;</span><br><span class="line">user=&quot;yapidba&quot;</span><br><span class="line">password=&quot;123456&quot;</span><br><span class="line">hostname=&quot;localhost&quot;</span><br><span class="line">port=&quot;27017&quot;</span><br><span class="line"> </span><br><span class="line"># move old data to olddatapath</span><br><span class="line">if [ &quot;`ls -A $&#123;datapath&#125;`&quot; != &quot;&quot; ];then</span><br><span class="line">    mv $&#123;datapath&#125;&apos;/&apos;*$&#123;databasename&#125;* $&#123;olddatapath&#125; 2&gt;/dev/null</span><br><span class="line">fi</span><br><span class="line"> </span><br><span class="line"># gen new backup</span><br><span class="line">now=$(date +&quot;%Y-%m-%d&quot;)</span><br><span class="line">file=$&#123;datapath&#125;&apos;/&apos;$&#123;databasename&#125;-$now</span><br><span class="line">$&#123;mdpath&#125; -h$&#123;hostname&#125;:$&#123;port&#125; -u$&#123;user&#125; -p$&#123;password&#125; -d$&#123;databasename&#125; -o$&#123;file&#125;</span><br><span class="line">#echo $&#123;mdpath&#125; -h$&#123;hostname&#125;:$&#123;port&#125; -u$&#123;user&#125; -p$&#123;password&#125; -d$&#123;databasename&#125; -o$&#123;file&#125;</span><br><span class="line"> </span><br><span class="line"># clean up over 7 days</span><br><span class="line">sevendays=$(date -d -7day +&quot;%Y-%m-%d&quot;)</span><br><span class="line">if [ -d $&#123;olddatapath&#125;&apos;/&apos;$databasename&apos;-&apos;$sevendays ];then</span><br><span class="line">    rm -rf $&#123;olddatapath&#125;&apos;/&apos;$databasename&apos;-&apos;$sevendays</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">&gt;crontab -e</span><br><span class="line">0 2 * * * /home/yapi/backup/backup.sh</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;centos7下yapi安装&quot;&gt;&lt;a href=&quot;#centos7下yapi安装&quot; class=&quot;headerlink&quot; title=&quot;centos7下yapi安装&quot;&gt;&lt;/a&gt;centos7下yapi安装&lt;/h1&gt;&lt;hr&gt;&lt;h2 id=&quot;1-安装前系统优化&quot;&gt;&lt;a href=&quot;#1-安装前系统优化&quot; class=&quot;headerlink&quot; title=&quot;1. 安装前系统优化&quot;&gt;&lt;/a&gt;1. 安装前系统优化&lt;/h2&gt;&lt;h2 id=&quot;2-安装&quot;&gt;&lt;a href=&quot;#2-安装&quot; class=&quot;headerlink&quot; title=&quot;2. 安装&quot;&gt;&lt;/a&gt;2. 安装&lt;/h2&gt;&lt;h3 id=&quot;2-1-安装nodejs&quot;&gt;&lt;a href=&quot;#2-1-安装nodejs&quot; class=&quot;headerlink&quot; title=&quot;2.1 安装nodejs&quot;&gt;&lt;/a&gt;2.1 安装nodejs&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;获取安装包&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget http://nodejs.org/dist/v11.9.0/node-v11.9.0-linux-x64.tar.gz  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;解压&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar xf node-v11.9.0-linux-x64.tar.gz &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;链接到 /usr/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo ln -s /TRS/softwares/node-v11.9.0-linux-x64/bin/node /usr/bin/node&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo ln -s /TRS/softwares/node-v11.9.0-linux-x64/bin/npm /usr/bin/npm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;校验&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node -v&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;npm -v&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下NFS服务安装</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-04-12T08:15:09.381Z</published>
    <updated>2019-11-09T16:02:20.607Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下NFS服务安装"><a href="#centos7下NFS服务安装" class="headerlink" title="centos7下NFS服务安装"></a>centos7下NFS服务安装</h1><hr><h2 id="1-说明"><a href="#1-说明" class="headerlink" title="1. 说明"></a>1. 说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">此文档为安装nfs服务的说明文档，由10.15.110.7服务器提供nfs服务，10.15.110.8挂载对应的目录，实现文件夹共享功能</span><br></pre></td></tr></table></figure><h2 id="2-提供共享服务器操作说明-10-15-110-7"><a href="#2-提供共享服务器操作说明-10-15-110-7" class="headerlink" title="2. 提供共享服务器操作说明(10.15.110.7)"></a>2. 提供共享服务器操作说明(10.15.110.7)</h2><h3 id="2-1-安装nfs、rpcbind服务-root用户操作"><a href="#2-1-安装nfs、rpcbind服务-root用户操作" class="headerlink" title="2.1 安装nfs、rpcbind服务[root用户操作]"></a>2.1 安装nfs、rpcbind服务[root用户操作]</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">-&gt;检查服务器是否安装</span><br><span class="line">rpm -qa nfs-utils rpcbind</span><br><span class="line">-&gt;安装nfs、rpcbind</span><br><span class="line">yum install nfs-utils rpcbind</span><br><span class="line">-&gt;先启动rpcbind，再启动nfs服务</span><br><span class="line">systemctl start rpcbind.service</span><br><span class="line">systemctl start nfs.service</span><br><span class="line">-&gt;为rpcbind、nfs做开机自动启动</span><br><span class="line">systemctl enable rpcbind.service</span><br><span class="line">systemctl enable nfs.service</span><br><span class="line">-&gt;查看rpc端口</span><br><span class="line">lsof –i:111</span><br><span class="line">-&gt;如果无法使用lsof命令</span><br><span class="line">yum install net-tools lsof</span><br><span class="line">-&gt;查看rpc注册的端口信息</span><br><span class="line">rpcinfo -p localhost</span><br><span class="line">-&gt;nfs启动时会随机启动多个端口，需要通过修改配置文件设置固定端口</span><br><span class="line">cd /etc/sysconfig &amp;&amp; cp nfs nfs.20190412.bak</span><br><span class="line">vi nfs</span><br><span class="line">-&gt;内容</span><br><span class="line">RQUOTAD_PORT=30001</span><br><span class="line">LOCKD_TCPPORT=30002</span><br><span class="line">LOCKD_UDPPORT=30002</span><br><span class="line">MOUNTD_PORT=30003</span><br><span class="line">STATD_PORT=30004</span><br><span class="line"></span><br><span class="line">-&gt;重启 rpcbind和nfs</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line"></span><br><span class="line">-&gt;配置防火墙</span><br><span class="line">-&gt;将2049、111、30001-30004端口向10.15.110.8 （注意按服务器实际IP修改）服务器开放</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=2049  protocol=tcp  accept&quot;</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=2049  protocol=udp  accept&quot;</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=111  protocol=tcp  accept&quot;</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=111  protocol=udp  accept&quot;</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=30001-30004  protocol=tcp  accept&quot;</span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=ipv4 source address=10.15.110.8 port port=30001-30004  protocol=udp  accept&quot;</span><br><span class="line"></span><br><span class="line">-&gt;载入生效</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-&gt;配置共享目录</span><br><span class="line">vi /etc/exports</span><br><span class="line">-&gt;增加一行</span><br><span class="line">/data/TRS/WCMData  10.15.110.8(rw,sync,anonuid=1000,anongid=1000)</span><br><span class="line">-&gt;注：其中ip请按实际服务器做调整，anonuid为本机cjrb用户的uid，anongid为本机cjrb用户组id。查看id方式为：</span><br><span class="line">cat /etc/passwd | grep cjrb</span><br><span class="line">-&gt;x 后面第一个数字为uid，第二个数字为gid</span><br><span class="line">-&gt;加载nfs配置</span><br><span class="line">exportfs –rv</span><br><span class="line">-&gt;查看nfs服务器挂载情况</span><br><span class="line">showmount -e localhost</span><br><span class="line">-&gt;重启服务器检查软件自启动情况</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h2 id="3-nfs客户端服务器操作说明-10-15-110-8"><a href="#3-nfs客户端服务器操作说明-10-15-110-8" class="headerlink" title="3. nfs客户端服务器操作说明(10.15.110.8)"></a>3. nfs客户端服务器操作说明(10.15.110.8)</h2><h3 id="3-1-安装nfs、rpcbind服务-root用户操作"><a href="#3-1-安装nfs、rpcbind服务-root用户操作" class="headerlink" title="3.1. 安装nfs、rpcbind服务[root用户操作]"></a>3.1. 安装nfs、rpcbind服务[root用户操作]</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-&gt;检查nfs/rpc程序有没有安装</span><br><span class="line">rpm -qa rpcbind nfs-utils</span><br><span class="line">-&gt;安装nfs与rpc软件</span><br><span class="line">yum install rpcbind nfs-utils</span><br><span class="line">-&gt;启动rpcbind</span><br><span class="line">-&gt;先为rpcbind做开机启动：</span><br><span class="line">systemctl enable rpcbind.service</span><br><span class="line">-&gt;然后启动rpcbind服务：</span><br><span class="line">systemctl start rpcbind.service</span><br><span class="line">-&gt;注：客户端不需要启动nfs服务。</span><br><span class="line">-&gt;检查 NFS 服务器端是否有目录共享</span><br><span class="line">showmount -e 10.15.110.7</span><br><span class="line">-&gt;挂载目录</span><br><span class="line">mount -t nfs 10.15.110.7:/data/TRS/WCMData /data/TRS/WCMData</span><br><span class="line">-&gt;开机自动挂载</span><br><span class="line">vi /etc/fstab</span><br><span class="line">-&gt;增加：</span><br><span class="line">10.15.110.7:/data/TRS/WCMData/data/TRS/WCMDatanfsdefaults0 0</span><br><span class="line">-&gt;可重启服务器检查nfs挂载自启动情况</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;centos7下NFS服务安装&quot;&gt;&lt;a href=&quot;#centos7下NFS服务安装&quot; class=&quot;headerlink&quot; title=&quot;centos7下NFS服务安装&quot;&gt;&lt;/a&gt;centos7下NFS服务安装&lt;/h1&gt;&lt;hr&gt;&lt;h2 id=&quot;1-说明&quot;&gt;&lt;a href=&quot;#1-说明&quot; class=&quot;headerlink&quot; title=&quot;1. 说明&quot;&gt;&lt;/a&gt;1. 说明&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;此文档为安装nfs服务的说明文档，由10.15.110.7服务器提供nfs服务，10.15.110.8挂载对应的目录，实现文件夹共享功能&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2 id=&quot;2-提供共享服务器操作说明-10-15-110-7&quot;&gt;&lt;a href=&quot;#2-提供共享服务器操作说明-10-15-110-7&quot; class=&quot;headerlink&quot; title=&quot;2. 提供共享服务器操作说明(10.15.110.7)&quot;&gt;&lt;/a&gt;2. 提供共享服务器操作说明(10.15.110.7)&lt;/h2&gt;&lt;h3 id=&quot;2-1-安装nfs、rpcbind服务-root用户操作&quot;&gt;&lt;a href=&quot;#2-1-安装nfs、rpcbind服务-root用户操作&quot; class=&quot;headerlink&quot; title=&quot;2.1 安装nfs、rpcbind服务[root用户操作]&quot;&gt;&lt;/a&gt;2.1 安装nfs、rpcbind服务[root用户操作]&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;检查服务器是否安装&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpm -qa nfs-utils rpcbind&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;安装nfs、rpcbind&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install nfs-utils rpcbind&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;先启动rpcbind，再启动nfs服务&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start rpcbind.service&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start nfs.service&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;为rpcbind、nfs做开机自动启动&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl enable rpcbind.service&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl enable nfs.service&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;查看rpc端口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lsof –i:111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;如果无法使用lsof命令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install net-tools lsof&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;查看rpc注册的端口信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rpcinfo -p localhost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;nfs启动时会随机启动多个端口，需要通过修改配置文件设置固定端口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd /etc/sysconfig &amp;amp;&amp;amp; cp nfs nfs.20190412.bak&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vi nfs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;内容&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RQUOTAD_PORT=30001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCKD_TCPPORT=30002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCKD_UDPPORT=30002&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MOUNTD_PORT=30003&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;STATD_PORT=30004&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;重启 rpcbind和nfs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart rpcbind&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart nfs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;配置防火墙&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;将2049、111、30001-30004端口向10.15.110.8 （注意按服务器实际IP修改）服务器开放&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=2049  protocol=tcp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=2049  protocol=udp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=111  protocol=tcp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=111  protocol=udp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=30001-30004  protocol=tcp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --permanent --add-rich-rule=&amp;quot;rule family=ipv4 source address=10.15.110.8 port port=30001-30004  protocol=udp  accept&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;载入生效&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --reload&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;firewall-cmd --list-all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;配置共享目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vi /etc/exports&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;增加一行&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/data/TRS/WCMData  10.15.110.8(rw,sync,anonuid=1000,anongid=1000)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;注：其中ip请按实际服务器做调整，anonuid为本机cjrb用户的uid，anongid为本机cjrb用户组id。查看id方式为：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat /etc/passwd | grep cjrb&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;x 后面第一个数字为uid，第二个数字为gid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;加载nfs配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exportfs –rv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;查看nfs服务器挂载情况&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;showmount -e localhost&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt;重启服务器检查软件自启动情况&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reboot&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下minio安装部署</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-03-19T12:41:46.700Z</published>
    <updated>2019-11-09T16:02:20.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下minio安装部署"><a href="#centos7下minio安装部署" class="headerlink" title="centos7下minio安装部署"></a>centos7下minio安装部署</h1><h2 id="1-获取安装包"><a href="#1-获取安装包" class="headerlink" title="1.获取安装包"></a>1.获取安装包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.minio.io/server/minio/release/linux-amd64/minio</span><br></pre></td></tr></table></figure><h2 id="2-分配执行权限"><a href="#2-分配执行权限" class="headerlink" title="2.分配执行权限"></a>2.分配执行权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x minio</span><br></pre></td></tr></table></figure><h2 id="2-启动"><a href="#2-启动" class="headerlink" title="2.启动"></a>2.启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./minio server /TRS/data</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;centos7下minio安装部署&quot;&gt;&lt;a href=&quot;#centos7下minio安装部署&quot; class=&quot;headerlink&quot; title=&quot;centos7下minio安装部署&quot;&gt;&lt;/a&gt;centos7下minio安装部署&lt;/h1&gt;&lt;h2 id=&quot;1-获取安
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下rabbitmq安装部署</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-03-19T12:41:46.700Z</published>
    <updated>2019-11-09T16:02:20.617Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下rabbitmq安装部署"><a href="#centos7下rabbitmq安装部署" class="headerlink" title="centos7下rabbitmq安装部署"></a>centos7下rabbitmq安装部署</h1><h2 id="1-获取安装包"><a href="#1-获取安装包" class="headerlink" title="1.获取安装包"></a>1.获取安装包</h2><h3 id="1-1-rabbitmq-server-3-7-14-1-el7-noarch-rpm"><a href="#1-1-rabbitmq-server-3-7-14-1-el7-noarch-rpm" class="headerlink" title="1.1 rabbitmq-server-3.7.14-1.el7.noarch.rpm"></a>1.1 rabbitmq-server-3.7.14-1.el7.noarch.rpm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github-production-release-asset-2e65be.s3.amazonaws.com/924551/2868b700-51c1-11e9-812b-054eaf8204b3?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20190409%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20190409T080328Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=95c31a0d941878f8927fd813c3f1a12d808ed36add28d5776f414229e8935d82&amp;X-Amz-SignedHeaders=host&amp;actor_id=7186314&amp;response-content-disposition=attachment%3B%20filename%3Drabbitmq-server-3.7.14-1.el7.noarch.rpm&amp;response-content-type=application%2Foctet-stream</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h3 id="1-2-erlang-21-3-3-1-el7-x86-64-rpm"><a href="#1-2-erlang-21-3-3-1-el7-x86-64-rpm" class="headerlink" title="1.2 erlang-21.3.3-1.el7.x86_64.rpm"></a>1.2 erlang-21.3.3-1.el7.x86_64.rpm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github-production-release-asset-2e65be.s3.amazonaws.com/47679505/27e06100-54de-11e9-8d36-bf4e72b14aef?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20190409%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20190409T082502Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=0335f2373555efa3f351f2330eda271a1c776f2c42518527c60f1ee4a47b8560&amp;X-Amz-SignedHeaders=host&amp;actor_id=7186314&amp;response-content-disposition=attachment%3B%20filename%3Derlang-21.3.3-1.el7.x86_64.rpm&amp;response-content-type=application%2Foctet-stream</span><br></pre></td></tr></table></figure><h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h2><h3 id="2-1-安装erlang"><a href="#2-1-安装erlang" class="headerlink" title="2.1 安装erlang"></a>2.1 安装erlang</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh erlang-21.3.3-1.el7.x86_64.rpm</span><br><span class="line">-&gt;校验</span><br><span class="line">erl</span><br></pre></td></tr></table></figure><h3 id="2-1-安装abbitmq-server"><a href="#2-1-安装abbitmq-server" class="headerlink" title="2.1 安装abbitmq-server"></a>2.1 安装abbitmq-server</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh rabbitmq-server-3.7.14-1.el7.noarch.rpm</span><br><span class="line">-&gt;报错：error: Failed dependencies: socat is needed by rabbitmq-server-3.7.14-1.el7.noarch</span><br><span class="line">-&gt;安装socat</span><br><span class="line">sudo yum -y install socat</span><br><span class="line">-&gt;重新执行安装</span><br><span class="line">-&gt;校验安装</span><br><span class="line">sudo rabbitmqctl -q status</span><br></pre></td></tr></table></figure><h2 id="2-运行"><a href="#2-运行" class="headerlink" title="2. 运行"></a>2. 运行</h2><h3 id="2-1-状态查看"><a href="#2-1-状态查看" class="headerlink" title="2.1 状态查看"></a>2.1 状态查看</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status rabbitmq-server.service</span><br></pre></td></tr></table></figure><h3 id="2-2-启动"><a href="#2-2-启动" class="headerlink" title="2.2 启动"></a>2.2 启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start rabbitmq-server.service</span><br></pre></td></tr></table></figure><h3 id="2-3-停止"><a href="#2-3-停止" class="headerlink" title="2.3 停止"></a>2.3 停止</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop rabbitmq-server.service</span><br></pre></td></tr></table></figure><h3 id="2-3-开机自启"><a href="#2-3-开机自启" class="headerlink" title="2.3 开机自启"></a>2.3 开机自启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable rabbitmq-server.service</span><br></pre></td></tr></table></figure><h2 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h2><h3 id="3-1-核心配置文件配置"><a href="#3-1-核心配置文件配置" class="headerlink" title="3.1 核心配置文件配置"></a>3.1 核心配置文件配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TODO</span><br></pre></td></tr></table></figure><h2 id="3-2-用户授权"><a href="#3-2-用户授权" class="headerlink" title="3.2 用户授权"></a>3.2 用户授权</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-&gt;添加用户</span><br><span class="line">sudo rabbitmqctl add_user trswcm trs#cjrb</span><br><span class="line">-&gt;删除用户</span><br><span class="line">sudo rabbitmqctl delete_user trswcm</span><br><span class="line">-&gt;修改密码</span><br><span class="line">sudo rabbitmqctl change_password trswcm NEW_PASSWORD</span><br><span class="line">-&gt;使用户trswcm /(可以访问虚拟主机) 中所有资源的配置、写、读权限以便管理其中的资源</span><br><span class="line">sudo rabbitmqctl set_permissions -p &quot;/&quot; trswcm &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">-&gt;查看用户授权</span><br><span class="line">sudo rabbitmqctl list_permissions -p /</span><br><span class="line">-&gt;查看当前用户列表</span><br><span class="line">sudo rabbitmqctl list_users</span><br><span class="line">-&gt;添加角色</span><br><span class="line">sudo rabbitmqctl set_user_tags trswcm administrator</span><br><span class="line">-&gt;清除权限信息</span><br><span class="line">sudo rabbitmqctl  clear_permissions  -p /  trswcm</span><br><span class="line">-&gt;开启rabbitmq管理控制台</span><br><span class="line">sudo rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><h3 id="3-3-端口开放-root用户操作"><a href="#3-3-端口开放-root用户操作" class="headerlink" title="3.3 端口开放[root用户操作]"></a>3.3 端口开放[root用户操作]</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-&gt;amqp端口</span><br><span class="line">firewall-cmd --zone=public --add-port=5672/tcp --permanent</span><br><span class="line">-&gt;http端口</span><br><span class="line">firewall-cmd --zone=public --add-port=15672/tcp --permanent</span><br><span class="line">-&gt;clustering端口</span><br><span class="line">firewall-cmd --zone=public --add-port=25672/tcp --permanent</span><br><span class="line">-&gt;刷新配置      </span><br><span class="line">firewall-cmd --reload       </span><br><span class="line">-&gt;查看已开放的端口      </span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><h3 id="3-4-WEB访问"><a href="#3-4-WEB访问" class="headerlink" title="3.4 WEB访问"></a>3.4 WEB访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.15.110.8:15672</span><br></pre></td></tr></table></figure><h3 id="3-5-添加vhost并授权"><a href="#3-5-添加vhost并授权" class="headerlink" title="3.5 添加vhost并授权"></a>3.5 添加vhost并授权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请登录web端创建vhost，大小写敏感</span><br><span class="line">1）添加分发中心vhost：DC</span><br><span class="line">2）添加消息推送vhost：PUSH</span><br><span class="line">重启分发中心和推送中心，可在rabbimq的web页面-connections里看到对应连接信息</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;centos7下rabbitmq安装部署&quot;&gt;&lt;a href=&quot;#centos7下rabbitmq安装部署&quot; class=&quot;headerlink&quot; title=&quot;centos7下rabbitmq安装部署&quot;&gt;&lt;/a&gt;centos7下rabbitmq安装部署&lt;/h1&gt;&lt;h2 id=&quot;1-获取安装包&quot;&gt;&lt;a href=&quot;#1-获取安装包&quot; class=&quot;headerlink&quot; title=&quot;1.获取安装包&quot;&gt;&lt;/a&gt;1.获取安装包&lt;/h2&gt;&lt;h3 id=&quot;1-1-rabbitmq-server-3-7-14-1-el7-noarch-rpm&quot;&gt;&lt;a href=&quot;#1-1-rabbitmq-server-3-7-14-1-el7-noarch-rpm&quot; class=&quot;headerlink&quot; title=&quot;1.1 rabbitmq-server-3.7.14-1.el7.noarch.rpm&quot;&gt;&lt;/a&gt;1.1 rabbitmq-server-3.7.14-1.el7.noarch.rpm&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https://github-production-release-asset-2e65be.s3.amazonaws.com/924551/2868b700-51c1-11e9-812b-054eaf8204b3?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20190409%2Fus-east-1%2Fs3%2Faws4_request&amp;amp;X-Amz-Date=20190409T080328Z&amp;amp;X-Amz-Expires=300&amp;amp;X-Amz-Signature=95c31a0d941878f8927fd813c3f1a12d808ed36add28d5776f414229e8935d82&amp;amp;X-Amz-SignedHeaders=host&amp;amp;actor_id=7186314&amp;amp;response-content-disposition=attachment%3B%20filename%3Drabbitmq-server-3.7.14-1.el7.noarch.rpm&amp;amp;response-content-type=application%2Foctet-stream&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下nodejs安装</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-03-14T13:00:44.776Z</published>
    <updated>2019-11-09T16:02:20.620Z</updated>
    
    <content type="html"><![CDATA[<h1 id="centos7下nodejs安装"><a href="#centos7下nodejs安装" class="headerlink" title="centos7下nodejs安装"></a>centos7下nodejs安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;1.下载源码包</span><br><span class="line">wget http://nodejs.org/dist/v11.9.0/node-v11.9.0-linux-x64.tar.gz</span><br><span class="line">&gt;2.解压</span><br><span class="line">tar xf node-v8.9.0-linux-x86.tar.gz</span><br><span class="line">&gt;3.进入解压目录</span><br><span class="line">cd node-v8.9.0-linux-x86</span><br><span class="line">&gt;4.执行node命令 查看版本</span><br><span class="line">./bin/node -v</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;centos7下nodejs安装&quot;&gt;&lt;a href=&quot;#centos7下nodejs安装&quot; class=&quot;headerlink&quot; title=&quot;centos7下nodejs安装&quot;&gt;&lt;/a&gt;centos7下nodejs安装&lt;/h1&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>jenkens在centos7安装部署使用</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-03-04T14:45:11.016Z</published>
    <updated>2019-11-09T16:02:20.631Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jenkens在centos7安装部署使用"><a href="#jenkens在centos7安装部署使用" class="headerlink" title="jenkens在centos7安装部署使用"></a>jenkens在centos7安装部署使用</h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><h3 id="1-1-创建安装目录"><a href="#1-1-创建安装目录" class="headerlink" title="1.1.创建安装目录"></a>1.1.创建安装目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /opt/jenkins &amp;&amp; cd /opt/jenkins</span><br></pre></td></tr></table></figure><h3 id="1-2-下载通用war包"><a href="#1-2-下载通用war包" class="headerlink" title="1.2.下载通用war包"></a>1.2.下载通用war包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/latest/jenkins.war</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><h3 id="1-3-后台运行jenkins"><a href="#1-3-后台运行jenkins" class="headerlink" title="1.3.后台运行jenkins"></a>1.3.后台运行jenkins</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;自定义端口为：9876</span><br><span class="line">nohup java -jar jenkins.war --httpPort=9876 &gt; temp.txt &amp;</span><br></pre></td></tr></table></figure><h3 id="1-3-获取登录密码"><a href="#1-3-获取登录密码" class="headerlink" title="1.3.获取登录密码"></a>1.3.获取登录密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat temp.txt</span><br><span class="line">&gt;找到星号行包着的内容里的一串即为解锁密码</span><br></pre></td></tr></table></figure><h3 id="1-4-访问jenkins"><a href="#1-4-访问jenkins" class="headerlink" title="1.4.访问jenkins"></a>1.4.访问jenkins</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://IP:9876</span><br><span class="line">&gt;使用上步操作获取的密码解锁</span><br></pre></td></tr></table></figure><h3 id="1-5-安装插件并完成初始化"><a href="#1-5-安装插件并完成初始化" class="headerlink" title="1.5.安装插件并完成初始化"></a>1.5.安装插件并完成初始化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;新手用户建议直接选择第一个：安装推荐的插件</span><br><span class="line">&gt;安装完成后会出现初始化用户界面，大家可以自己选择是否进行初始化。如果不想初始化新用户的话可以点击左下角的使用admin账户继续即可。初始化的工作完成后就会进入jenkins的首页</span><br></pre></td></tr></table></figure><h3 id="1-6-全局工具配置"><a href="#1-6-全局工具配置" class="headerlink" title="1.6.全局工具配置"></a>1.6.全局工具配置</h3><h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2.使用"></a>2.使用</h2><h3 id="2-1-结合git部署node应用"><a href="#2-1-结合git部署node应用" class="headerlink" title="2.1 结合git部署node应用"></a>2.1 结合git部署node应用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;jenkins安装nodejs插件</span><br><span class="line">&gt;设置node和npm为全局变量</span><br><span class="line">#ln -s /home/项目目录/node-v8.3.0-linux-x64/bin/node    /usr/local/bin/node</span><br><span class="line">#ln -s /home/项目目录/node-v8.3.0-linux-x64/bin/npm     /usr/local/bin/npm</span><br><span class="line"></span><br><span class="line">npm install -g  nrm</span><br><span class="line">npm install -g  gulp</span><br><span class="line">&gt;设置nrm和gulp为全局变量</span><br><span class="line">#ln -s /home/项目目录/node-v8.3.0-linux-x64/bin/nrm     /usr/local/bin/nrm</span><br><span class="line">#ln -s /home/项目目录/node-v8.3.0-linux-x64/bin/gulp     /usr/local/bin/gulp</span><br><span class="line"></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">&gt;进入项目根目录安装gulp插件</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">&gt;requires a peer of react@^0.14.0 || ^15.0.0-0 || ^16.0.0 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm install react react-dom</span><br><span class="line">npm install -g gulp-cli</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;jenkens在centos7安装部署使用&quot;&gt;&lt;a href=&quot;#jenkens在centos7安装部署使用&quot; class=&quot;headerlink&quot; title=&quot;jenkens在centos7安装部署使用&quot;&gt;&lt;/a&gt;jenkens在centos7安装部署使用&lt;/h1&gt;&lt;h2 id=&quot;1-安装&quot;&gt;&lt;a href=&quot;#1-安装&quot; class=&quot;headerlink&quot; title=&quot;1.安装&quot;&gt;&lt;/a&gt;1.安装&lt;/h2&gt;&lt;h3 id=&quot;1-1-创建安装目录&quot;&gt;&lt;a href=&quot;#1-1-创建安装目录&quot; class=&quot;headerlink&quot; title=&quot;1.1.创建安装目录&quot;&gt;&lt;/a&gt;1.1.创建安装目录&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo mkdir -p /opt/jenkins &amp;amp;&amp;amp; cd /opt/jenkins&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&quot;1-2-下载通用war包&quot;&gt;&lt;a href=&quot;#1-2-下载通用war包&quot; class=&quot;headerlink&quot; title=&quot;1.2.下载通用war包&quot;&gt;&lt;/a&gt;1.2.下载通用war包&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https://mirrors.tuna.tsinghua.edu.cn/jenkins/war-stable/latest/jenkins.war&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下nginx高并发配置</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2019-01-17T03:00:29.187Z</published>
    <updated>2019-11-09T16:02:20.622Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centos7下nginx高并发配置"><a href="#centos7下nginx高并发配置" class="headerlink" title="#centos7下nginx高并发配置"></a>#centos7下nginx高并发配置</h2><p>##系统层优化</p><ol><li><p>系统信息查看</p><blockquote><p>确认是64位还是32位:</p><blockquote><p>uname -a</p></blockquote></blockquote><blockquote><p>核数—&gt;</p><blockquote><p>cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c</p></blockquote></blockquote><blockquote><p>逻辑CPU信息:</p><blockquote><p>cat /proc/cpuinfo | grep physical | uniq -c</p></blockquote></blockquote><blockquote><p>CPU运行在多少位模式下:</p><blockquote><p>getconf LONG_BIT</p></blockquote></blockquote><blockquote><p>查看环境变量:</p><blockquote><p>env</p></blockquote></blockquote><blockquote><p>查看平均负载情况[除了前3个数字表示平均进程数量外，后面的1个分数，分母表示系统进程总数，分子表示正在运行的进程数；最后一个数字表示最近运行的进程ID]:</p><blockquote><p>cat /proc/loadavg</p></blockquote></blockquote><blockquote><p>内存的详细信息:</p><blockquote><p>cat /proc/meminfo</p></blockquote></blockquote><blockquote><p>查看所有网络接口的属性:</p><blockquote><p>ifconfig</p></blockquote></blockquote><blockquote><p>带宽:</p><blockquote><p>ethtool 网卡名</p></blockquote></blockquote><blockquote><p>查看路由表</p><blockquote><p>route -n</p></blockquote></blockquote><blockquote><p>查看所有已经建立的连接:</p><blockquote><p>netstat -antp</p></blockquote></blockquote><blockquote><p>某端口使用情况:</p><blockquote><p>lsof -i:端口号<br>netstat -apn|grep 端口号</p></blockquote></blockquote><blockquote><p>查看系统所有用户:</p><blockquote><p>cut -d: -f1 /etc/passwd</p></blockquote></blockquote><blockquote><p>查看当前使用的拥塞算法</p><blockquote><p>sysctl net.ipv4.tcp_available_congestion_control<br>lsmod | grep bbr</p></blockquote></blockquote></li><li><p>优化TCP连接数[/etc/sysctl.conf]</p><blockquote><p>修改/etc/sysctl.conf</p><blockquote><p>vi /etc/sysctl.conf</p></blockquote></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">kernel.pid_max = 64512</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 4096</span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line">net.ipv4.tcp_keepalive_time = 300</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 4</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 6000</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_rmem = 4096</span><br><span class="line">net.ipv4.tcp_wmem = 4096</span><br><span class="line">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="line">net.core.rmem_max = 8388608</span><br><span class="line">net.core.wmem_max = 8388608</span><br><span class="line">net.core.somaxconn = 262144</span><br><span class="line">net.core.netdev_max_backlog = 262144</span><br><span class="line"></span><br><span class="line">net.nf_conntrack_max = 655360</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_established = 180</span><br><span class="line"></span><br><span class="line">vm.overcommit_memory = 1</span><br><span class="line"></span><br><span class="line">#以下bbr加速模式需要内核4.9.0以上</span><br><span class="line">#net.core.default_qdisc = fq</span><br><span class="line">#net.ipv4.tcp_congestion_control = bbr</span><br></pre></td></tr></table></figure><blockquote><p>使配置生效</p><blockquote><p>/sbin/sysctl -p</p></blockquote></blockquote></li><li><p>调整最大文件打开数</p><blockquote><p>vim /etc/security/limits.conf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft nproc  10240</span><br><span class="line">* hard nproc  10240</span><br></pre></td></tr></table></figure><blockquote><p>vim /etc/security/limits.d/20-nproc.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* soft nproc  10240</span><br><span class="line">* root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>或者加入开机启动每次自动设置<br>vim /etc/rc.local</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -SHn 65535</span><br><span class="line">ulimit -s 65535</span><br></pre></td></tr></table></figure></li><li><p>调整字符集，使其支持中文</p><blockquote><p>locale -a 可通过grep过滤查看是否有中文语言包<br>如果没有语言包</p><blockquote><p>yum install kde-l10n-Chinese<br>yum reinstall glibc-common</p></blockquote></blockquote><blockquote><p>vim /etc/locale.conf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;source /etc/locale.conf</span><br><span class="line"></span><br><span class="line">##nginx优化配置参考[nginx.conf]</span><br></pre></td></tr></table></figure><p>user www www;<br>#nginx进程数，建议按照cpu数目来指定，一般跟cpu核数相同或为它的倍数<br>worker_processes 8;<br>worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000;<br>error_log /www/log/nginx_error.log crit;<br>pid /usr/local/nginx/nginx.pid;<br>worker_rlimit_nofile 65535;<br>tcp_nopush on;<br>server_tokens off;</p></li></ol><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><p>events<br>{<br>use epoll;<br>worker_connections 65535;<br>}</p><p>http<br>{<br>include mime.types;<br>default_type application/octet-stream;</p><p>charset utf-8;</p><p>server_names_hash_bucket_size 128;<br>client_header_buffer_size 2k;<br>large_client_header_buffers 4 4k;<br>client_max_body_size 8m;</p><p>sendfile on;<br>tcp_nopush on;</p><p>keepalive_timeout 60;</p><p>fastcgi_cache_path /usr/local/nginx/fastcgi_cache levels=1:2<br>keys_zone=TEST:10m<br>inactive=5m;<br>fastcgi_connect_timeout 300;<br>fastcgi_send_timeout 300;<br>fastcgi_read_timeout 300;<br>fastcgi_buffer_size 16k;<br>fastcgi_buffers 16 16k;<br>fastcgi_busy_buffers_size 16k;<br>fastcgi_temp_file_write_size 16k;<br>fastcgi_cache TEST;<br>fastcgi_cache_valid 200 302 1h;<br>fastcgi_cache_valid 301 1d;<br>fastcgi_cache_valid any 1m;<br>fastcgi_cache_min_uses 1;<br>fastcgi_cache_use_stale error timeout invalid_header http_500;<br>open_file_cache max=204800 inactive=20s;<br>open_file_cache_min_uses 1;<br>open_file_cache_valid 30s;</p><p>tcp_nodelay on;</p><p>gzip on;<br>gzip_min_length 1k;<br>gzip_buffers 4 16k;<br>gzip_http_version 1.0;<br>gzip_comp_level 2;<br>gzip_types text/plain application/x-javascript text/css application/xml;<br>gzip_vary on;</p><p>server<br>{<br>listen 8080;<br>server_name huan.wangshibo.com;<br>index index.php index.htm;<br>root /www/html/;</p><pre><code>location /status{    stub_status on;}location ~ .*\.(php|php5)?${    fastcgi_pass 127.0.0.1:9000;    fastcgi_index index.php;    include fcgi.conf;}location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css)${  expires       30d;}log_format   access   &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;          &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;          &apos;&quot;$http_user_agent&quot; $http_x_forwarded_for&apos;;access_log   /www/log/access.log   access;  }</code></pre><p>}</p><pre><code></code></pre><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;centos7下nginx高并发配置&quot;&gt;&lt;a href=&quot;#centos7下nginx高并发配置&quot; class=&quot;headerlink&quot; title=&quot;#centos7下nginx高并发配置&quot;&gt;&lt;/a&gt;#centos7下nginx高并发配置&lt;/h2&gt;&lt;p&gt;##系统层优化&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;p&gt;系统信息查看&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;确认是64位还是32位:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;uname -a&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;核数—&amp;gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;逻辑CPU信息:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;cat /proc/cpuinfo | grep physical | uniq -c&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;CPU运行在多少位模式下:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;getconf LONG_BIT&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看环境变量:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;env&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看平均负载情况[除了前3个数字表示平均进程数量外，后面的1个分数，分母表示系统进程总数，分子表示正在运行的进程数；最后一个数字表示最近运行的进程ID]:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;cat /proc/loadavg&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;内存的详细信息:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;cat /proc/meminfo&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看所有网络接口的属性:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ifconfig&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;带宽:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;ethtool 网卡名&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看路由表&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;route -n&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看所有已经建立的连接:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;netstat -antp&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;某端口使用情况:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;lsof -i:端口号&lt;br&gt;netstat -apn|grep 端口号&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看系统所有用户:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;cut -d: -f1 /etc/passwd&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;查看当前使用的拥塞算法&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;sysctl net.ipv4.tcp_available_congestion_control&lt;br&gt;lsmod | grep bbr&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;优化TCP连接数[/etc/sysctl.conf]&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;修改/etc/sysctl.conf&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;vi /etc/sysctl.conf&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;kernel.pid_max = 64512&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_max_syn_backlog = 4096&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.icmp_echo_ignore_broadcasts = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_timestamps = 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_fin_timeout = 30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_keepalive_time = 300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_keepalive_probes = 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_tw_reuse = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_tw_recycle = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_max_tw_buckets = 6000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_syncookies = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_rmem = 4096&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_wmem = 4096&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.ip_local_port_range = 1024 65000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.rmem_max = 8388608&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.wmem_max = 8388608&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.somaxconn = 262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.netdev_max_backlog = 262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.nf_conntrack_max = 655360&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.netfilter.nf_conntrack_tcp_timeout_established = 180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vm.overcommit_memory = 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#以下bbr加速模式需要内核4.9.0以上&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#net.core.default_qdisc = fq&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#net.ipv4.tcp_congestion_control = bbr&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;blockquote&gt;&lt;p&gt;使配置生效&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;/sbin/sysctl -p&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;调整最大文件打开数&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;vim /etc/security/limits.conf&lt;/p&gt;&lt;/blockquote&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;* soft nofile 65535&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* hard nofile 65535&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* soft nproc  10240&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* hard nproc  10240&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;blockquote&gt;&lt;p&gt;vim /etc/security/limits.d/20-nproc.conf&lt;/p&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;* soft nproc  10240&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* root       soft    nproc     unlimited&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;或者加入开机启动每次自动设置&lt;br&gt;vim /etc/rc.local&lt;/p&gt;&lt;/blockquote&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ulimit -SHn 65535&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ulimit -s 65535&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;调整字符集，使其支持中文&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;locale -a 可通过grep过滤查看是否有中文语言包&lt;br&gt;如果没有语言包&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;yum install kde-l10n-Chinese&lt;br&gt;yum reinstall glibc-common&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;p&gt;vim /etc/locale.conf&lt;/p&gt;&lt;/blockquote&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;gt;source /etc/locale.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##nginx优化配置参考[nginx.conf]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;user www www;&lt;br&gt;#nginx进程数，建议按照cpu数目来指定，一般跟cpu核数相同或为它的倍数&lt;br&gt;worker_processes 8;&lt;br&gt;worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000;&lt;br&gt;error_log /www/log/nginx_error.log crit;&lt;br&gt;pid /usr/local/nginx/nginx.pid;&lt;br&gt;worker_rlimit_nofile 65535;&lt;br&gt;tcp_nopush on;&lt;br&gt;server_tokens off;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>linux日志切割logrotate安装配置</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2018-12-19T06:32:00.089Z</published>
    <updated>2019-11-09T16:02:20.637Z</updated>
    
    <content type="html"><![CDATA[<p>#linux日志切割logrotate安装配置</p><hr><p>##安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1. 安装</span><br><span class="line">&gt;yum -y install logratate</span><br><span class="line">2. 以下以nginx日志切割为例：</span><br><span class="line">&gt;cd /etc/logrotate.d</span><br><span class="line">&gt;创建针对nginx日志切割的脚本</span><br><span class="line">&gt;vim nginx</span><br><span class="line">&gt;内容如下：</span><br><span class="line">/usr/local/nginx/logs/*.log &#123;</span><br><span class="line">        weekly</span><br><span class="line">        rotate 5</span><br><span class="line">        compress</span><br><span class="line">        delaycompress</span><br><span class="line">        missingok</span><br><span class="line">        notifempty</span><br><span class="line">        sharedscripts</span><br><span class="line">        postrotate</span><br><span class="line">                if [ -f /usr/local/nginx/logs/nginx.pid ]; then</span><br><span class="line">                        kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">                fi</span><br><span class="line">        endscript</span><br><span class="line">&#125;</span><br><span class="line">&gt;执行以下脚本会在nginx日志目录生成如***error.log.1***的文件</span><br><span class="line">&gt;/usr/sbin/logrotate -f /etc/logrotate.d/nginx</span><br><span class="line"></span><br><span class="line">3. 加入定时任务</span><br><span class="line">&gt;crontab -e</span><br><span class="line">&gt;输入以下内容</span><br><span class="line">#logrotate</span><br><span class="line">50 23 * * * /usr/sbin/logrotate -f /etc/logrotate.d/nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;#linux日志切割logrotate安装配置&lt;/p&gt;&lt;hr&gt;&lt;p&gt;##安装&lt;/p&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下tomcat改为高性能的apr模式</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2018-12-18T07:33:04.386Z</published>
    <updated>2019-11-09T16:02:20.627Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centos7下tomcat改为高性能的apr模式"><a href="#centos7下tomcat改为高性能的apr模式" class="headerlink" title="#centos7下tomcat改为高性能的apr模式"></a>#centos7下tomcat改为高性能的apr模式</h2><p><strong><em>jdk1.7以上</em></strong></p><p>##安装apr相关依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1. 从http://apr.apache.org/download.cgi下载apr、apr-util、apr-iconv三个文件,下面三个是当前最新版本，可以找到下载地址直接wget命令现在到服务器：</span><br><span class="line">https://mirrors.cnnic.cn/apache/apr/apr-1.6.5.tar.gz</span><br><span class="line">http://mirrors.tuna.tsinghua.edu.cn/apache/apr/apr-util-1.6.1.tar.gz</span><br><span class="line">http://mirrors.tuna.tsinghua.edu.cn/apache/apr/apr-iconv-1.2.2.tar.gz</span><br><span class="line"></span><br><span class="line">2. 解压、编译安装apr</span><br><span class="line">&gt;tar xf apr-1.6.5.tar.gz</span><br><span class="line">&gt;cd apr-1.6.5</span><br><span class="line">&gt;./configure --prefix=/usr/local/apr</span><br><span class="line">&gt;&gt;&gt;报错：error: no acceptable C compiler found in $PATH</span><br><span class="line">&gt;yum install gcc</span><br><span class="line">&gt;&gt;&gt;报错：cannot remove &apos;libtoolT&apos;: No such file or directory</span><br><span class="line">&gt;&gt;&gt;vim configure</span><br><span class="line">&gt;&gt;&gt;搜索并把这一行用#注释掉：$RM &quot;$cfgfile&quot;</span><br><span class="line">&gt;&gt;&gt;重新执行：./configure --prefix=/usr/local/apr</span><br><span class="line">&gt;root用户执行编译与安装</span><br><span class="line">&gt;make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">3. 解压、编译安装apr-util</span><br><span class="line">&gt;tar xf apr-util-1.6.1.tar.gz</span><br><span class="line">&gt;cd apr-util-1.6.1</span><br><span class="line">&gt;./configure --prefix=/usr/local/apr-util --with-apr=/usr/local/apr</span><br><span class="line">&gt;root用户执行编译与安装</span><br><span class="line">&gt;make &amp;&amp; make install</span><br><span class="line">&gt;&gt;&gt;报错：fatal error: expat.h: No such file or directory</span><br><span class="line">&gt;&gt;&gt;yum install expat-devel</span><br><span class="line">&gt;&gt;&gt;重新执行：make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">4. 增加环境变量</span><br><span class="line">&gt;备份配置</span><br><span class="line">&gt;cp /etc/profile /etc/profile.bak</span><br><span class="line">&gt;vim /etc/profile</span><br><span class="line">&gt;最后一行加上：export LD_LIBRARY_PATH=/usr/local/apr/lib</span><br><span class="line">&gt;source /etc/profile</span><br><span class="line"></span><br><span class="line">5. 安装apr-iconv</span><br><span class="line">&gt;tar xf apr-iconv-1.2.2.tar.gz</span><br><span class="line">&gt;cd apr-iconv-1.2.2</span><br><span class="line">&gt;./configure --prefix=/usr/local/apr-iconv --with-apr=/usr/local/apr</span><br><span class="line">&gt;root用户执行编译与安装</span><br><span class="line">&gt;make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">6. 安装tomcat-native</span><br><span class="line">&gt;进入tomcat主目录/bin下，有tomcat-native.tar.gz文件，没有另外单独下载</span><br><span class="line">&gt;tar xf tomcat-native.tar.gz</span><br><span class="line">&gt;进入解压后的目录，具体以解压目录名称为准，不同tomcat版本可能不一样</span><br><span class="line">&gt;cd tomcat-native-1.1.24-src/jni/native/</span><br><span class="line">&gt;编译时需指定apr目录和JAVA_HOME目录，通过命令 echo $JAVA_HOME 查看</span><br><span class="line">&gt;./configure --with-apr=/usr/local/apr/bin/apr-1-config --with-java-home=/opt/app4www/application/jdk1.8.0_77</span><br><span class="line">&gt;root用户执行编译与安装</span><br><span class="line">&gt;make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">7. 修改tomcat的server.xml配置</span><br><span class="line">&gt;进入tomcat主目录/conf</span><br><span class="line">&gt;备份配置</span><br><span class="line">&gt;cp server.xml server.xml.bak</span><br><span class="line">&gt;vim server.xml</span><br><span class="line">&gt;在Connector节点，将protocol值改为org.apache.coyote.http11.Http11AprProtocol</span><br><span class="line">&gt;&lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; useAprConnector=&quot;true&quot; SSLEngine=&quot;on&quot; /&gt;</span><br><span class="line">&gt;重启tomcat，看到如http-apr表示成功！</span><br><span class="line">&gt;&gt;&gt;如果有SSLEngine相关的报错，可以在server.xml把SSLEngine值设为off关闭这个功能</span><br><span class="line"></span><br><span class="line">8. 自定义环境变量</span><br><span class="line">&gt;在 bin下 新建 setenv.sh</span><br><span class="line">&gt;vi bin/setenv.sh</span><br><span class="line">&gt;内容</span><br><span class="line">#如果服务器有多个jdk版本，需要指定使用的是哪个；只有一个的话，可以注释掉</span><br><span class="line">JAVA_HOME=/opt/java</span><br><span class="line">#add tomcat pid</span><br><span class="line">CATALINA_PID=&quot;$CATALINA_BASE/tomcat.pid&quot;</span><br><span class="line">#add java opts</span><br><span class="line">#JAVA_OPTS=&quot;-server -XX:PermSize=256M -XX:MaxPermSize=1024m -Xms512M -Xmx1024M -XX:MaxNewSize=256m&quot;</span><br><span class="line">JAVA_OPTS=&quot;-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=256m -XX:PermSize=512m -XX:MaxPermSize=512m&quot;</span><br><span class="line"></span><br><span class="line">&gt;增加可执行权限</span><br><span class="line">chmod u+x bin/setenv.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;centos7下tomcat改为高性能的apr模式&quot;&gt;&lt;a href=&quot;#centos7下tomcat改为高性能的apr模式&quot; class=&quot;headerlink&quot; title=&quot;#centos7下tomcat改为高性能的apr模式&quot;&gt;&lt;/a&gt;#centos7下t
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>centos7下安装PHP7</title>
    <link href="https://huazhiy.xyz/undefined/abbrlink.html"/>
    <id>https://huazhiy.xyz/undefined/abbrlink.html</id>
    <published>2018-12-14T09:51:52.500Z</published>
    <updated>2019-11-09T16:02:20.629Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centos7下PHP7安装"><a href="#centos7下PHP7安装" class="headerlink" title="#centos7下PHP7安装"></a>#centos7下PHP7安装</h2><p>##获取并解压PHP源代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://php.net/manual/zh/install.unix.nginx.php</span><br><span class="line">http://tw2.php.net/get/php-7.3.0.tar.gz/from/this/mirror</span><br><span class="line">```</span><br><span class="line">##配置并构建PHP</span><br></pre></td></tr></table></figure><a id="more"></a><!-- build time:Sun Nov 10 2019 03:07:41 GMT+0800 (中国标准时间) --><pre><code>./configure --enable-fpm --with-curl=/usr/local/lib/curl    &gt;&gt;&gt; 如有这个报错---&gt;configure: error: libxml2 not found. Please check your libxml2 installation.    &gt;&gt;&gt;yum install libxml2-devel    &gt;&gt;&gt;重新执行首个php的编译命令    &gt;&gt;&gt;报错curl相关单独下载curl    &gt;&gt;&gt;下载并安装 curl     &gt;&gt;&gt;wget https://curl.haxx.se/download/curl-7.55.1.tar.gz    &gt;&gt;&gt;tar -zxvf curl-7.55.1.tar.gz    &gt;&gt;&gt;cd curl-7.55.1    &gt;&gt;&gt;mkdir /usr/local/lib/curl    &gt;&gt;&gt;./configure --prefix=/usr/local/lib/curl/    &gt;&gt;&gt;make &amp;&amp; make install    &gt;&gt;&gt;重新执行首个php的编译命令make &amp;&amp; make install&gt;&gt;&gt;查看php版本php -v&gt;&gt;&gt;查看已安装扩展php -m</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">####创建配置文件，并将其复制到正确的位置</span><br></pre></td></tr></table></figure><pre><code>cp php.ini-development /usr/local/php/php.inicp /usr/local/etc/php-fpm.conf.default /usr/local/etc/php-fpm.confcp sapi/fpm/php-fpm /usr/local/bincp /usr/local/etc/php-fpm.d/www.conf.default /usr/local/etc/php-fpm.d/www.conf</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">###修改配置</span><br><span class="line">```</span><br><span class="line">vim /usr/local/php/php.ini</span><br><span class="line">&gt;&gt;&gt;cgi.fix_pathinfo=0</span><br><span class="line">vim /usr/local/etc/php-fpm.conf</span><br><span class="line">&gt;&gt;&gt;末尾确保引入路径为:include=/usr/local/etc/php-fpm.d/*.conf</span><br><span class="line">vim /usr/local/etc/php-fpm.d/www.conf</span><br><span class="line">&gt;&gt;&gt;用户和组根据实际情况修改，否则出现与后面步骤配置的文件上传路径无权限写入文件等问题</span><br><span class="line">&gt;&gt;&gt;user = www-data</span><br><span class="line">&gt;&gt;&gt;group = www-data</span><br><span class="line">```</span><br><span class="line">##启动php-fpm服务</span><br></pre></td></tr></table></figure><pre><code>/usr/local/bin/php-fpm    &gt;&gt;&gt;提示用户组不存在之类的直接创建    &gt;&gt;&gt;groupadd www-data    &gt;&gt;&gt;useradd -g www-data www-dataps -ef|grep php-fpmnetstat -tnl | grep 9000</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##停止php-fpm</span><br></pre></td></tr></table></figure><pre><code>pkill php-fpm</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">##php-fpm加入系统服务</span><br></pre></td></tr></table></figure><pre><code>vi /lib/systemd/system/php-fpm.service&gt;&gt;&gt;内容如下：    [Unit]    Description=php-fpm    After=network.target    [Service]    Type=forking    ExecStart=/usr/local/bin/php-fpm    ExecStop=/bin/pkill -9 php-fpm    PrivateTmp=true    [Install]    WantedBy=multi-user.target&gt;&gt;&gt;开启服务，如果服务是开启状态，使用此命令会启动失败systemctl start php-fpm.service&gt;&gt;&gt;查看服务状态systemctl status php-fpm.servicesystemctl list-units --type=service |grep php&gt;&gt;&gt;停止服务systemctl stop php-fpm.service&gt;&gt;&gt;加入开机启动systemctl enable php-fpm.service</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##nginx配置</span><br></pre></td></tr></table></figure><pre><code>1.在server节点增加如下配置：以下以365编辑器识别php接口的配置举例 # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000location ~ \.php$ {        # root指向php脚本所在目录        # 此配置与前端请求接口要一一对应，这里代理到了php这一级，意味着前端访问php接口不再需要php前缀，前端php接口配置在ueditor.config.js里面        root           /data/TRS/application/php;        fastcgi_pass   127.0.0.1:9000;        fastcgi_index  index.php;        fastcgi_param  SCRIPT_FILENAME  /data/TRS/application/php/$fastcgi_script_name;        include        fastcgi_params;}# 配置已上传图片的文件的访问（图片的上传路径在php/config.json里面配置）location /upload/ {        # root根据php/config.json里各种文件的配置而定，如果是类似/upload/image/{yyyy}{mm}{dd}/{time}{rand:6}则可以配成以下这样        root   /data/TRS/application/php/;}</code></pre><pre><code>***注意：此种部署适合单机php环境下，否则需要自己处理集群环境文件共享问题***</code></pre><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;centos7下PHP7安装&quot;&gt;&lt;a href=&quot;#centos7下PHP7安装&quot; class=&quot;headerlink&quot; title=&quot;#centos7下PHP7安装&quot;&gt;&lt;/a&gt;#centos7下PHP7安装&lt;/h2&gt;&lt;p&gt;##获取并解压PHP源代码&lt;/p&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	http://php.net/manual/zh/install.unix.nginx.php&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	http://tw2.php.net/get/php-7.3.0.tar.gz/from/this/mirror&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;```	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##配置并构建PHP&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
    
  </entry>
  
</feed>
